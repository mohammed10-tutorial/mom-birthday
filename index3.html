<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Birthday Stage 3 - Elegant Dark Theme Lanterns</title>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@700&family=Poppins:wght@400;600&display=swap" rel="stylesheet" />

<style>
  /* --- Base & Background --- */
  html, body {
    margin: 0; padding: 0; overflow: hidden;
    height: 100%; width: 100%;
    background: linear-gradient(135deg, #121317, #1c1f26);
    font-family: 'Poppins', sans-serif;
    user-select: none;
    color: #cfd8dc; /* light grey-blue */
    position: relative;
  }

  /* --- Stars --- */
  #stars {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    pointer-events: none;
    z-index: 0;
    background: transparent;
  }
  .star {
    position: absolute;
    background: #b0bec5;
    border-radius: 50%;
    opacity: 0.6;
    animation-name: twinkle;
    animation-iteration-count: infinite;
    animation-timing-function: ease-in-out;
  }
  @keyframes twinkle {
    0%, 100% {opacity: 0.2;}
    50% {opacity: 1;}
  }

  /* --- Container --- */
  #container {
    position: relative;
    height: 100%;
    width: 100%;
    overflow: hidden;
    z-index: 10;
  }

  /* --- Lanterns --- */
  .lantern {
    position: absolute;
    bottom: 0;
    border-radius: 18px 18px 10px 10px;
    box-shadow:
      0 0 8px 3px rgba(255, 230, 180, 0.3); /* minimal soft golden glow */
    cursor: default;
    transition: background 0.5s ease;
    will-change: transform;
  }

  /* --- Sparkle --- */
  .sparkle {
    position: absolute;
    width: 6px;
    height: 6px;
    background: radial-gradient(circle at center, #ffeaa7, #f6e58d);
    border-radius: 50%;
    pointer-events: none;
    opacity: 0.9;
    filter: drop-shadow(0 0 6px #f9ca24);
    animation: sparkleFade 0.8s forwards;
  }
  @keyframes sparkleFade {
    0% {opacity: 0.9; transform: scale(1);}
    100% {opacity: 0; transform: scale(1.8);}
  }

  /* --- Photo Container --- */
  #photoContainer {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    opacity: 0;
    transition: opacity 1.5s ease;
    z-index: 20;
    font-family: 'Merriweather', serif;
  }
  #photoContainer img {
    max-width: 340px;
    max-height: 340px;
    border-radius: 28px;
    box-shadow: 0 0 40px 10px rgba(255, 230, 180, 0.6);
  }
  #photoContainer h2 {
    margin-top: 18px;
    font-weight: 700;
    font-size: 3rem;
    color: #f9ca24; /* golden text */
    text-shadow: 0 0 12px #f39c12;
  }
  #photoContainer p {
    margin-top: 8px;
    font-size: 1.4rem;
    color: #d1c4a1;
    font-style: italic;
  }

  /* --- Responsive Lantern Sizes --- */
  @media (max-width: 600px) {
    .lantern {
      width: 40px !important;
      height: 60px !important;
    }
    #questionBox, #replyBox {
      width: 90vw !important;
      padding: 20px 24px !important;
      font-size: 1.3rem !important;
    }
    #questionBox button, #replyBox button {
      font-size: 1.1rem !important;
      padding: 10px 20px !important;
      margin: 10px 8px 0 8px !important;
    }
    #photoContainer img {
      max-width: 250px !important;
      max-height: 250px !important;
    }
    #photoContainer h2 {
      font-size: 2rem !important;
    }
    #photoContainer p {
      font-size: 1rem !important;
    }
    #banner {
      font-size: 1.8rem !important;
      padding: 12px 24px !important;
    }
  }
  @media (min-width: 601px) {
    .lantern {
      width: 44px !important;
      height: 66px !important;
    }
    #questionBox, #replyBox {
      width: auto !important;
      padding: 30px 42px !important;
      font-size: 1.9rem !important;
    }
    #questionBox button, #replyBox button {
      font-size: 1.5rem !important;
      padding: 14px 32px !important;
      margin: 20px 16px 0 16px !important;
    }
  }

  /* --- Question and Reply Boxes (Dark Professional) --- */
  #questionBox, #replyBox {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(40, 44, 52, 0.95); /* dark slate */
    padding: 30px 42px;
    border-radius: 24px;
    box-shadow: 0 0 35px 10px rgba(80, 84, 95, 0.8);
    text-align: center;
    font-size: 1.9rem;
    font-weight: 600;
    color: #b0bec5; /* muted light blue-gray */
    user-select: none;
    z-index: 30;
    display: none;
    font-family: 'Poppins', sans-serif;
    max-width: 480px;
  }

  #questionBox button, #replyBox button {
    background: #2e3a47; /* dark steel blue */
    border: none;
    color: #d1d9e6; /* soft light */
    font-weight: 700;
    font-size: 1.5rem;
    padding: 14px 32px;
    margin: 20px 16px 0 16px;
    border-radius: 18px;
    cursor: pointer;
    transition: background-color 0.35s ease;
    font-family: 'Poppins', sans-serif;
  }
  #questionBox button:hover, #replyBox button:hover {
    background: #3e5064; /* lighter steel */
    color: #fff;
  }

  /* --- Happy Birthday Banner --- */
  #banner {
    position: fixed;
    top: 16px; left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(45deg, #2c3e50, #34495e);
    padding: 16px 32px;
    border-radius: 36px;
    font-family: 'Merriweather', serif;
    font-size: 2.4rem;
    font-weight: 900;
    color: #ecf0f1;
    box-shadow: 0 0 30px 10px rgba(44, 62, 80, 0.8);
    z-index: 50;
    user-select: none;
    letter-spacing: 3px;
    text-shadow: 0 0 8px #2c3e50;
    max-width: 95vw;
    text-align: center;
  }
</style>
</head>
<body>

<div id="stars"></div>

<div id="banner">Happy Birthday Ammi</div>

<div id="container">
  <div id="lanternsContainer"></div>

  <div id="photoContainer" aria-live="polite" aria-atomic="true">
    <img src="mom-photo.jpg" alt="Photo of Mom" />
    <h2>I love you, Ammi</h2>
    <p>"Khuda tamare lambi umar de ane har dua puri kare.."</p>
  </div>

  <div id="questionBox" role="dialog" aria-modal="true" aria-labelledby="questionText">
    <div id="questionText">Will you forgive me for all my mistakes?</div>
    <button id="yesBtn">Yes</button>
    <button id="noBtn">No</button>
  </div>

  <div id="replyBox" role="dialog" aria-modal="true" aria-labelledby="replyText">
    <div id="replyText">Haha.. I know you will thank you MOTIII... ðŸ¤ª</div>
    <button id="replyCloseBtn">Close</button>
  </div>
</div>

<!-- Audio elements -->
<audio id="backgroundSound" src="background3.mp3" preload="auto" loop></audio>
<audio id="popSound" src="pop.mp3" preload="auto"></audio>
<audio id="sparkleSound" src="sparkle.mp3" preload="auto"></audio>
<audio id="photoAppearSound" src="photo-appear.mp3" preload="auto"></audio>
<audio id="questionAppearSound" src="question-appear.mp3" preload="auto"></audio>
<audio id="buttonHoverSound" src="button-hover.mp3" preload="auto"></audio>
<audio id="buttonClickSound" src="button-click.mp3" preload="auto"></audio>
<audio id="yesSound" src="yes-sound.mp3" preload="auto"></audio>
<audio id="noSound" src="no-sound.mp3" preload="auto"></audio>

<script>
  // Stars
  const starsContainer = document.getElementById('stars');
  const starCount = 100;
  for(let i=0; i<starCount; i++) {
    const star = document.createElement('div');
    star.classList.add('star');
    const size = Math.random() * 2 + 0.5;
    star.style.width = `${size}px`;
    star.style.height = `${size}px`;
    star.style.top = `${Math.random() * 100}%`;
    star.style.left = `${Math.random() * 100}%`;
    star.style.animationDuration = `${2 + Math.random() * 3}s`;
    star.style.animationDelay = `${Math.random() * 5}s`;
    starsContainer.appendChild(star);
  }

  // Play background music after first user interaction
  const backgroundSound = document.getElementById('backgroundSound');
  backgroundSound.volume = 0.35;

  function playBackgroundMusic() {
    backgroundSound.play().catch(() => {});
    window.removeEventListener('click', playBackgroundMusic);
  }
  window.addEventListener('click', playBackgroundMusic);

  const lanternsContainer = document.getElementById('lanternsContainer');
  const photoContainer = document.getElementById('photoContainer');
  const questionBox = document.getElementById('questionBox');
  const replyBox = document.getElementById('replyBox');

  const yesBtn = document.getElementById('yesBtn');
  const noBtn = document.getElementById('noBtn');
  const replyCloseBtn = document.getElementById('replyCloseBtn');

  // Sound elements
  const popSound = document.getElementById('popSound');
  const sparkleSound = document.getElementById('sparkleSound');
  const photoAppearSound = document.getElementById('photoAppearSound');
  const questionAppearSound = document.getElementById('questionAppearSound');
  const buttonHoverSound = document.getElementById('buttonHoverSound');
  const buttonClickSound = document.getElementById('buttonClickSound');
  const yesSound = document.getElementById('yesSound');
  const noSound = document.getElementById('noSound');

  function randomRange(min, max) {
    return Math.random() * (max - min) + min;
  }

  // Elegant minimal lantern colors gradients
  const lanternColors = [
    'linear-gradient(180deg, #5d6d7e, #34495e)', // slate blue
    'linear-gradient(180deg, #7e8ca0, #2c3e50)', // steel blue
    'linear-gradient(180deg, #8eacbb, #34495e)', // soft blue gray
    'linear-gradient(180deg, #616161, #424242)', // gray to dark gray
    'linear-gradient(180deg, #6d4c41, #3e2723)', // dark brown
    'linear-gradient(180deg, #7b5e57, #4e342e)', // muted brown
    'linear-gradient(180deg, #455a64, #263238)', // blue gray dark
    'linear-gradient(180deg, #546e7a, #37474f)', // steel blue darker
  ];

  const lanternCount = 12;
  const lanterns = [];

  for(let i=0; i<lanternCount; i++){
    const lan = document.createElement('div');
    lan.classList.add('lantern');

    const xPercent = randomRange(5, 90);
    lan.style.left = `${xPercent}%`;

    let width, height;
    if(window.innerWidth <= 600){
      width = randomRange(40, 55);
    } else {
      width = randomRange(30, 50);
    }
    height = width * 1.5;

    lan.style.width = `${width}px`;
    lan.style.height = `${height}px`;

    lan.style.background = lanternColors[Math.floor(Math.random() * lanternColors.length)];

    lanternsContainer.appendChild(lan);

    const delay = randomRange(0, 10000);

    lanterns.push({
      el: lan,
      xPercent,
      translateY: window.innerHeight + height, // start offscreen below viewport
      speed: randomRange(3500, 6000), // ms to reach near top
      popped: false,
      popTimeout: null,
      startTime: null,
      height,
      delay,
      started: false,
      forcedPopTimeout: null,
    });
  }

  function createSparkle(x, y){
    const sparkle = document.createElement('div');
    sparkle.className = 'sparkle';
    sparkle.style.left = `${x}px`;
    sparkle.style.top = `${y}px`;
    document.body.appendChild(sparkle);
    sparkleSound.currentTime = 0;
    sparkleSound.play();
    setTimeout(() => sparkle.remove(), 800);
  }

  function popLantern(lan) {
    if (lan.popped) return;
    lan.popped = true;
    const rect = lan.el.getBoundingClientRect();
    popSound.currentTime = 0;
    popSound.play();
    for (let i=0; i<3; i++) {
      setTimeout(() => {
        createSparkle(
          rect.left + rect.width/2 + randomRange(-8,8),
          rect.top + rect.height/2 + randomRange(-8,8)
        );
      }, i*100);
    }
    lan.el.style.transition = 'opacity 0.5s ease-out, transform 0.5s ease-out';
    lan.el.style.opacity = '0';
    lan.el.style.transform += ' scale(1.4)';
    setTimeout(() => lan.el.remove(), 500);

    if (lanterns.every(l => l.popped)) {
      setTimeout(() => {
        photoContainer.style.opacity = '0';
        setTimeout(() => {
          questionAppearSound.currentTime = 0;
          questionAppearSound.play();
          questionBox.style.display = 'block';
        }, 1500);
      }, 500);
    }
  }

  function animate(timestamp){
    lanterns.forEach(lan => {
      if (lan.popped) return;

      if (!lan.started) {
        if (!lan.delayStart) lan.delayStart = timestamp;
        if (timestamp - lan.delayStart >= lan.delay) {
          lan.started = true;
          lan.startTime = timestamp;

          // Force pop after max 10 seconds from start to avoid stuck
          lan.forcedPopTimeout = setTimeout(() => {
            popLantern(lan);
          }, 10000);
        } else {
          // Position lantern below viewport while waiting
          lan.el.style.transform = `translateY(${lan.translateY}px)`;
          return;
        }
      }

      const elapsed = timestamp - lan.startTime;
      let progress = elapsed / lan.speed;
      if (progress > 1) progress = 1;

      // Calculate vertical position from bottom + translateY for smooth animation
      const startY = window.innerHeight + lan.height;
      const endY = window.innerHeight * 0.15; // near top (15% from top)

      const currentY = startY - (progress * (startY - endY));
      lan.translateY = currentY;

      lan.el.style.transform = `translateY(${currentY}px)`;

      // Once near top, pop lantern if not popped yet
      if (!lan.popTimeout && currentY <= endY + 10) {
        lan.popTimeout = setTimeout(() => {
          popLantern(lan);
          if (lan.forcedPopTimeout) clearTimeout(lan.forcedPopTimeout);
        }, 400);
      }
    });

    requestAnimationFrame(animate);
  }

  requestAnimationFrame(animate);

  // Show photo after 7 seconds independent of lanterns
  setTimeout(() => {
    photoAppearSound.currentTime = 0;
    photoAppearSound.play();
    photoContainer.style.opacity = '1';
  }, 7000);

  // Detect mobile devices
  function isMobile() {
    return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
  }

  // Button interactions
  yesBtn.addEventListener('mouseenter', () => {
    if (!isMobile()) {
      buttonHoverSound.currentTime = 0;
      buttonHoverSound.play();

      // Move Yes button randomly on hover (desktop only)
      const box = questionBox.getBoundingClientRect();
      const btnRect = yesBtn.getBoundingClientRect();
      const maxX = box.width - btnRect.width - 10;
      const maxY = box.height - btnRect.height - 10;
      const randomX = Math.random() * maxX;
      const randomY = Math.random() * maxY;
      yesBtn.style.position = 'relative';
      yesBtn.style.left = `${randomX}px`;
      yesBtn.style.top = `${randomY}px`;
    }
  });

  yesBtn.addEventListener('click', () => {
    yesSound.currentTime = 0;
    yesSound.play();

    // Always teleport button on click (desktop & mobile)
    const box = questionBox.getBoundingClientRect();
    const btnRect = yesBtn.getBoundingClientRect();
    const maxX = box.width - btnRect.width - 10;
    const maxY = box.height - btnRect.height - 10;
    const randomX = Math.random() * maxX;
    const randomY = Math.random() * maxY;
    yesBtn.style.position = 'relative';
    yesBtn.style.left = `${randomX}px`;
    yesBtn.style.top = `${randomY}px`;
  });

  noBtn.addEventListener('click', () => {
    noSound.currentTime = 0;
    noSound.play();
    questionBox.style.display = 'none';
    replyBox.style.display = 'block';
  });

  replyCloseBtn.addEventListener('click', () => {
    buttonClickSound.currentTime = 0;
    buttonClickSound.play();
    replyBox.style.display = 'none';
  });
</script>

</body>
</html>
